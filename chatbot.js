 // Product Database
        // Product Database: D-Mart Location Data
const productDatabase = {
    // Dals section
    "chana dal": {
        location: "You will find chana dal at column 5 and row 1.",
        category: "Dals",
        synonyms: ["chana dal", "chana"],
        stock: "In Stock",
        price: 100,
        quantity: "1Kg"
    },
    "moong dal": {
        location: "You will find moong dal at column 5 and row 2.",
        category: "Dals",
        synonyms: ["moong dal", "moong"],
        stock: "In Stock",
        price: 152,
        quantity: "1Kg"
    },
    "turdal": {
        location: "You will find turdal at column 5 and row 3.",
        category: "Dals",
        synonyms: ["turdal", "toor dal", "arhar dal", "dal toor"],
        stock: "In Stock",
        price: 64,
        quantity: "500 gm"
    },
    "udid dal": {
        location: "You will find udid dal at column 5 and row 4.",
        category: "Dals",
        synonyms: ["udid dal", "urad dal", "black gram dal", "dal urad"],
        stock: "In Stock",
        price: 142,
        quantity: "1kg"
    },
    "masoor dal": {
        location: "You will find masoor dal at column 5 and row 5.",
        category: "Dals",
        synonyms: ["masoor dal", "red lentil", "dal masoor"],
        stock: "In Stock",
        price: 101,
        quantity: "1kg"
    },


    // Pulses
    "rajma kashmiri": {
        location: "You will find rajma kashmiri at column 4 and row 1.",
        category: "Pulses",
        synonyms: ["rajma kashmiri", "rajma"],
        stock: "In Stock",
        price: 64,
        quantity: "500 gm"
    },
    "chowli": {
        location: "You will find chowli at column 4 and row 2.",
        category: "Pulses",
        synonyms: ["chowli", "cowpea", "lobia"],
        stock: "In Stock",
        price: 70,
        quantity: "500 gm"
    },
    "soya chunks": {
        location: "You will find soya chunks at column 4 and row 3.",
        category: "Pulses",
        synonyms: ["soya chunks", "soy chunks"],
        stock: "In Stock",
        price: 25,
        quantity: "200 gm"
    },
    "kabuli chana": {
        location: "You will find kabuli chana at column 4 and row 4.",
        category: "Pulses",
        synonyms: ["kabuli chana", "chickpea", "white chana"],
        stock: "In Stock",
        price: 162,
        quantity: "1kg"
    },
    "shengdana": {
        location: "You will find shengdana at column 4 and row 5.",
        category: "Pulses",
        synonyms: ["shengdana", "peanuts", "groundnut"],
        stock: "In Stock",
        price: 98,
        quantity: "500gm"
    },


    // Dry Fruits
    "badam": {
        location: "You will find badam at column 3 and row 1.",
        category: "Dry Fruits",
        synonyms: ["badam"],
        stock: "In Stock",
        price: 250,
        quantity: "1kg"
    },
    "almonds": {
        location: "You will find almonds at column 3 and row 2.",
        category: "Dry Fruits",
        synonyms: ["almonds"],
        stock: "In Stock",
        price: 499,
        quantity: "200gm"
    },
    "nuts": {
        location: "You will find nuts at column 3 and row 3.",
        category: "Dry Fruits",
        synonyms: ["nuts"],
        stock: "In Stock",
        price: 832,
        quantity: "1kg"
    },
    "pista": {
        location: "You will find pista at column 3 and row 4.",
        category: "Dry Fruits",
        synonyms: ["pista", "pistachio"],
        stock: "In Stock",
        price: 469,
        quantity: "400gm"
    },
    "khajur": {
        location: "You will find khajur at column 3 and row 5.",
        category: "Dry Fruits",
        synonyms: ["khajur", "dates"],
        stock: "In Stock",
        price: 209,
        quantity: "500gm"
    },


    // Cooking Oil
    "sunflower oil": {
        location: "You will find sunflower oil at aisle 2 and shelf 1.",
        category: "Cooking Oil",
        synonyms: ["sunflower oil", "oil"],
        stock: "In Stock",
        price: 152,
        quantity: "800gm"
    },
    "groundnut oil": {
        location: "You will find groundnut oil at aisle 2 and shelf 2.",
        category: "Cooking Oil",
        synonyms: ["groundnut oil", "peanut oil", "oil"],
        stock: "In Stock",
        price: 2205,
        quantity: "13kg"
    },
    "saffola oil": {
        location: "You will find saffola oil at aisle 3 and shelf 3.",
        category: "Cooking Oil",
        synonyms: ["saffola oil", "oil"],
        stock: "In Stock",
        price: 135,
        quantity: "850"
    },
    "mustard oil": {
        location: "You will find mustard oil at aisle 2 and shelf 4.",
        category: "Cooking Oil",
        synonyms: ["mustard oil", "oil"],
        stock: "In Stock",
        price: 188,
        quantity: "910"
    },
    "fortune soya oil": {
        location: "You will find fortune soya oil at aisle 3 and shelf 5.",
        category: "Cooking Oil",
        synonyms: ["fortune soya oil", "soya oil", "oil"],
        stock: "In Stock",
        price: 131,
        quantity: "810"
    },


    // Ghee
    "govardhan ghee": {
        location: "You will find govardhan ghee at aisle 1 and shelf 2.",
        category: "Ghee",
        synonyms: ["govardhan ghee"],
        stock: "In Stock",
        price: 1343,
        quantity: "1.81"
    },
    "patanjali ghee": {
        location: "You will find patanjali ghee at aisle 1 and shelf 4.",
        category: "Ghee",
        synonyms: ["patanjali ghee"],
        stock: "In Stock",
        price: 683,
        quantity: "815"
    },
    "amul ghee": {
        location: "You will find amul ghee at aisle 1 and shelf 7.",
        category: "Ghee",
        synonyms: ["amul ghee"],
        stock: "In Stock",
        price: 585,
        quantity: "905"
    },
    "govind ghee": {
        location: "You will find govind ghee at aisle 1 and shelf 3.",
        category: "Ghee",
        synonyms: ["govind ghee"],
        stock: "In Stock",
        price: 585,
        quantity: "1kg"
    },
    "sonai ghee": {
        location: "You will find sonai ghee at aisle 1 and shelf 5.",
        category: "Ghee",
        synonyms: ["sonai ghee"],
        stock: "In Stock",
        price: 603,
        quantity: "1.2kg"
    },


    // Rice Products
    "basmati rice": {
        location: "You will find basmati rice at the entrance and section 1.",
        category: "Rice Products",
        synonyms: ["basmati rice", "rice", "long grain rice", "charminar rice", "mogra rice", "devaaya rice"],
        stock: "In Stock",
        price: 290,
        quantity: "5kg"
    },
    "charminar rice": {
        location: "You will find charminar rice at the entrance and section 2.",
        category: "Rice Products",
        synonyms: ["charminar rice"],
        stock: "In Stock",
        price: 280,
        quantity: "5kg"
    },
    "mogra rice": {
        location: "You will find mogra rice at the entrance and section 3.",
        category: "Rice Products",
        synonyms: ["mogra rice"],
        stock: "In Stock",
        price: 270,
        quantity: "5kg"
    },
    "devaaya rice": {
        location: "You will find devaaya rice at the entrance and section 4.",
        category: "Rice Products",
        synonyms: ["devaaya rice"],
        stock: "In Stock",
        price: 260,
        quantity: "5kg"
    },
    "long grain rice": {
        location: "You will find long grain rice at the entrance and section 5.",
        category: "Rice Products",
        synonyms: ["long grain rice"],
        stock: "In Stock",
        price: 250,
        quantity: "5kg"
    },


    // Salt, Sugar, Jaggery
    "tata salt": {
        location: "You will find tata salt on the 2nd Floor, at the entrance and section 1.",
        category: "Salt",
        synonyms: ["tata salt"],
        stock: "In Stock",
        price: 25,
        quantity: "1kg"
    },
    "aashirvad salt": {
        location: "You will find aashirvad salt on the 2nd Floor, at the entrance and section 2.",
        category: "Salt",
        synonyms: ["aashirvad salt"],
        stock: "In Stock",
        price: 22,
        quantity: "1kg"
    },
    "madhur sugar": {
        location: "You will find madhur sugar on the 2nd Floor, at the entrance and section 3.",
        category: "Sugar",
        synonyms: ["madhur sugar"],
        stock: "In Stock",
        price: 247,
        quantity: "5kg"
    },
    "satyam sugar": {
        location: "You will find satyam sugar on the 2nd Floor, at the entrance and section 4.",
        category: "Sugar",
        synonyms: ["satyam sugar"],
        stock: "In Stock",
        price: 28,
        quantity: "500gm"
    },
    "jivana jaggery": {
        location: "You will find jivana jaggery on the 2nd Floor, at the entrance and section 5.",
        category: "Sugar",
        synonyms: ["jivana jaggery"],
        stock: "In Stock",
        price: 80,
        quantity: "500gm"
    },
    // Milk
"milk": {
    location: "You will find Milk in the Dairy Section, Back Right, Shelf 1.",
    category: "Milk",
    synonyms: ["milk", "dairy milk", "fresh milk", "cow milk", "milk carton", "dairy"],
    stock: "In Stock"
},


// Bread
"bread": {
    location: "You will find Bread in the Bakery Section, Aisle 2, Shelf 1.",
    category: "Bread",
    synonyms: ["bread", "white bread", "brown bread", "whole wheat bread", "loaf"],
    stock: "In Stock"
},


// Vegetables
"vegetables": {
    location: "You will find Vegetables in the Produce Section, Front Left, Open Display.",
    category: "Vegetables",
    synonyms: ["vegetables", "fresh vegetables", "veggies", "greens", "produce", "veggie"],
    stock: "In Stock"
}
};

        // Store Information
        const storeInfo = {
            name: "D-Mart Supermarket",
            hours: "8 AM to 11 PM (Daily)",
            contact: "1-800-DMART or www.dmart.in",
            email: "support@dmart.com"
        };

        // Initialize chat
        let conversationHistory = [];

        // Add initial welcome message
        window.addEventListener('DOMContentLoaded', () => {
            addBotMessage("Welcome to our Customer Service! üëã I'm here to help you find any product. What are you looking for?");
        });


        // Handle Enter key press
        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });


        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
           
            if (!message) return;
           
            // Add user message
            addUserMessage(message);
            input.value = '';
           
            // Process and respond
            setTimeout(() => {
                const response = processMessage(message);
                addBotMessage(response);
            }, 500);
        }


        function sendQuickQuery(query) {
            const input = document.getElementById('userInput');
            input.value = query;
            sendMessage();
        }

        function addUserMessage(text) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `
                <div class="message-avatar">üë§</div>
                <div class="message-content">${escapeHtml(text)}</div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
            conversationHistory.push({ role: 'user', text });
        }

        function addBotMessage(text) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.innerHTML = `
                <div class="message-avatar">ü§ñ</div>
                <div class="message-content">${text}</div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
            conversationHistory.push({ role: 'bot', text });
        }


        function scrollToBottom() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }


function processMessage(message) {
    const lowerMessage = message.toLowerCase().trim();
//other questions-
if (isGreeting(lowerMessage)) {
                return "Hello! üòä Welcome to Tell your trolley. How can I assist you today? You can ask me to find any product in our store.";
            }
           
            // Handle farewells
            if (isFarewell(lowerMessage)) {
                return "Thank you for shopping at tell your trolley! Have a great day! üëã Feel free to ask if you need anything else.";
            }
           
            // Handle store hours query
            if (lowerMessage.includes('hours') || lowerMessage.includes('open') || lowerMessage.includes('close') || lowerMessage.includes('timing')) {
                return `We're open from ${storeInfo.hours}. See you soon! üïê`;
            }
           
            // Handle contact query
            if (lowerMessage.includes('contact') || lowerMessage.includes('phone') || lowerMessage.includes('call') || lowerMessage.includes('email')) {
                return `You can contact us at ${storeInfo.contact} or email us at ${storeInfo.email}. üìû`;
            }
           
            // Handle thanks
            if (lowerMessage.includes('thank') || lowerMessage.includes('thanks')) {
                return "You're welcome! üòä Is there anything else I can help you find?";
            }

    // 1) Handle categories for button queries (Dals, Pulses, etc)
    const categories = [
        "dals", "pulses", "dry fruits", "cooking oil", "ghee", "rice products", "salt sugar jaggery"
    ];
    if (categories.includes(lowerMessage)) {
        const catProducts = Object.values(productDatabase).filter(product =>
            product.category.toLowerCase() === lowerMessage
        );
        if (catProducts.length === 0) {
            return `Sorry, no products found in ${lowerMessage}.`;
        }
        let reply = `Here are all items in <strong>${lowerMessage.charAt(0).toUpperCase() + lowerMessage.slice(1)}</strong>:<br>`;
        catProducts.forEach(p => {
            reply += `‚Ä¢ <strong>${p.synonyms[0]}</strong>: ${p.location}<br>`;
        });
        reply += `<br>Stock Status: ‚úÖ All are in stock.<br><br>Need anything else?`;
        return reply;
    }

    // 2) Handle family-word queries (dal, pulse, fruit, oil, ghee, rice, salt, sugar, jaggery)
    const familyWords = ["dal","pulse","fruit","oil","ghee","rice","salt","sugar","jaggery"];
    if (familyWords.includes(lowerMessage)) {
        // Find all products that contain this word as a full word
        const regex = new RegExp("\\b" + lowerMessage + "\\b", "i");
        const matches = Object.values(productDatabase).filter(product =>
            regex.test(product.category) ||
            product.synonyms.some(s => regex.test(s)) ||
            regex.test(product.synonyms[0]) || // in name
            regex.test(product.synonyms.join(' '))
        );
        if (matches.length > 0) {
            let reply = `Here are all items containing "<strong>${lowerMessage}</strong>":<br>`;
            matches.forEach(p => {
                reply += `‚Ä¢ <strong>${p.synonyms[0]}</strong>: ${p.location}<br>`;
            });
            reply += `<br>Stock Status: ‚úÖ All are in stock.<br><br>Need anything else?`;
            return reply;
        } else {
            return `Sorry, there are no items with "${lowerMessage}" in their name or category.`;
        }
    }

// 3) Multi-product match and price/quantity query support
const matchedProducts = Object.values(productDatabase).filter(p =>
    p.synonyms.some(syn => {
        const regex = new RegExp("\\b" + syn.toLowerCase().replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + "\\b", "i");
        return regex.test(lowerMessage);
    })
);


if (matchedProducts.length > 0) {
    // Check if user asked for price or quantity
    const priceOrQuantityAsked =
        lowerMessage.includes("price") ||
        lowerMessage.includes("cost") ||
        lowerMessage.includes("how much") ||
        lowerMessage.includes("quantity") ||
        lowerMessage.includes("how many");

    let reply = "";
    matchedProducts.forEach(product => {
        if (priceOrQuantityAsked && product.price !== undefined) {
            let qtyInfo = product.quantity !== undefined
                ? ` Unit quantity: <strong>${product.quantity}</strong>.`
                : "";
            reply += `The price of <strong>${getProductDisplayName(product)}</strong> is ‚Çπ${product.price} per unit.${qtyInfo}<br>`;
        } else {
            reply += `Great! We have ${getProductDisplayName(product)}. You can find it at:<br><strong>üìç${product.location}</strong><br>Stock Status: ‚úÖ ${product.stock}<br><br>`;
        }
    });
    return reply + "Need help finding anything else?";
}



    // 4) Default: use findProducts for broader phrase/keyword search
    const products = findProducts(lowerMessage);
    if (products.length === 1) {
        const productName = getProductDisplayName(products[0]);
        return `Great! We have ${productName}. You can find it at:<br><strong>üìç${products[0].location}</strong><br><br>Stock Status: ‚úÖ ${products[0].stock}<br><br>Need help finding anything else?`;
    } else if (products.length > 1) {
        let reply = "Great! Here's what I found:<br>";
        products.forEach(p => {
            reply += `‚Ä¢ <strong>${getProductDisplayName(p)}</strong>: ${p.location}<br>`;
        });
        reply += `<br>Stock Status: ‚úÖ All are in stock.<br><br>Need anything else?`;
        return reply;
    }

    // Not found fallback
    return `I couldn't find that product in our current inventory. ü§î<br><br>You can try:<br>‚Ä¢ Checking the spelling<br>‚Ä¢ Using a different product name<br>‚Ä¢ Asking about our popular items: Rice, Milk, Bread, Vegetables, Oil, Sugar, Tea, Coffee, or Snacks<br><br>How else can I help you?`;
}

        //change the code here


        //--- Product Search Function ---
function findProducts(query) {
    // Remove common question words and connectors like "and"
    const cleanQuery = query
        .replace(/where is|where's|find|locate|do you have|looking for|need|want|get me|show me|search|and|&/gi, '')
        .trim();


    const lowerQuery = cleanQuery.toLowerCase();
    let foundProducts = [];
    const foundKeys = new Set();


    // Search through all products and collect every match
    for (const [key, product] of Object.entries(productDatabase)) {
        for (const synonym of product.synonyms) {
            function findProducts(query) {
    // Remove common question words and connectors like "and"
    const cleanQuery = query
        .replace(/where is|where's|find|locate|do you have|looking for|need|want|get me|show me|search|and|&/gi, '')
        .trim();


    const lowerQuery = cleanQuery.toLowerCase();
    let foundProducts = [];
    const foundKeys = new Set();


    // Sort all synonyms from longest to shortest to ensure "moong dal" matches before just "dal"
    for (const [key, product] of Object.entries(productDatabase)) {
        // Make a sorted array of synonyms, longest first
        const sortedSynonyms = product.synonyms
            .slice()
            .sort((a, b) => b.length - a.length);


        for (const synonym of sortedSynonyms) {
            // Use strict phrase match
            if (lowerQuery === synonym.toLowerCase() && !foundKeys.has(key)) {
                foundProducts.push(product);
                foundKeys.add(key);
                break;
            }
            // Check for strict words between spaces or punctuation, avoid subword matches
            const regex = new RegExp("\\b" + synonym.toLowerCase().replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + "\\b", "i");
            if (regex.test(lowerQuery) && !foundKeys.has(key)) {
                foundProducts.push(product);
                foundKeys.add(key);
                break;
            }
        }
        // Also match the key itself strictly
        if ((lowerQuery === key || new RegExp("\\b" + key + "\\b", "i").test(lowerQuery)) && !foundKeys.has(key)) {
            foundProducts.push(product);
            foundKeys.add(key);
        }
    }
    return foundProducts;
}


        }
        if (lowerQuery.includes(key) && !foundKeys.has(key)) {
            foundProducts.push(product);
            foundKeys.add(key);
        }
    }


    return foundProducts; // Empty array if nothing found
}

        function getProductDisplayName(product) {
            // Return the first synonym as display name
            return product.synonyms[0].charAt(0).toUpperCase() + product.synonyms[0].slice(1);
        }


        function isGreeting(message) {
            const greetings = ['hello', 'hi', 'hey', 'good morning', 'good afternoon', 'good evening', 'greetings'];
            return greetings.some(greeting => message.includes(greeting));
        }


        function isFarewell(message) {
            const farewells = ['bye', 'goodbye', 'see you', 'good bye', 'farewell', 'later'];
            return farewells.some(farewell => message.includes(farewell));
        }


        function clearChat() {
            if (confirm('Are you sure you want to clear the chat history?')) {
                const messagesContainer = document.getElementById('chatMessages');
                messagesContainer.innerHTML = '';
                conversationHistory = [];
                // Re-add welcome message
                addBotMessage("Welcome to D-Mart Customer Service! üëã I'm here to help you find any product. What are you looking for?");
            }
        }


        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
           
             return div.innerHTML;
        }

